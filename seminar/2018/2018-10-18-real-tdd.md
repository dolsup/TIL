# TDD 제대로 알기

- 행사소개 [OKKYCON: 2018 TDD 제대로 알기](http://okkycon.com/)
- 2018년 10월 18일 (목) 08:30~18:00
- 삼성SDS타워 서관, B1 마젤란홀

---
> 발표 내용을 정리한게 아니라 들으면서 떠오른 내 생각 위주 정리. 따라서 발표자 의도와 다르게 해석했을 수 있음.

세미나 다녀와서 제일 머리 속에 남는 말들은

- 높은 응집, 낮은 결합
- 컨텍스트 안에서 적절한 추상화
- 의도를 드러내는 코드
- (적고 보니 위 세 가지는 전 동료분이 자주 사용하시던 말인 듯)
- 사용자에게 가치를 전달하는 소프트웨어

이제까지 단위테스트, TDD를 하려고 했던 이유는 많지만 그 중 가장 큰 건 내 코드에 대한 불신 때문이 컸는데,  앞으로는 위 목적을 이루기 위해 좀 더 노력 해야겠다는 생각을 함. 기술이든 방법론이든 모두 “사용자에게 가치를 전달하는 소프트웨어를 만든다”는 목적을 이루기 위한 수단 임을 다시 상기함.



## 테스트하기 쉬운 코드로 개발하기, 정진욱님

### 테스트 하기 쉬운 코드
- 순수함수의 특성을 가짐.
    - 같은 입력 같은 출력
    - 외부 상태를 변경하지 않는
- 시간, 데이터베이스, 외부API 등 통제 불가능한 것들은 위와 반대 특성을 가져 테스트가 어려움.
- 두 가지가 섞여 있다면 (테스트 하기) 쉬운것과 어려운 것을 분리.
- 메서드 또는 클래스를 나누고 관련 있는 것들을 응집.
- 테스트 하기 쉬운 것 이라도 테스트 하자.
- 인터페이스를 이음*Seam*이라고 부르는 것을 처음 들어봄.
- TODO: 발표자 분의 [Testing, Oh my!](http://jwchung.github.io/testing-oh-my) 글 읽어보기.


### 테스트를 통과하는만큼만 코드 작성하기 
- 발표를 들으면서 '앗차!' 하고 생각함.
- TDD를 실천하기 위한 기본 원칙 중 하나인데 잊고 있었음.
- TDD를 시도할 때 코드가 잘 짜지기 시작하면 테스트는 제쳐두고 세부 구현에 집중하다가 TDD 흐름이 깨지는 경험을 종종함.
- TODO: [RIP TDD by Kent Beck 번역](https://justhackem.wordpress.com/2018/06/24/what-tdd-solves/) 다시 읽어보기.


### Mock 에 대한 얘기들을 들으며 드는 생각
- TODO: 행위검증과 상태검증에 대해 찾아보기.
- 나는 항상 서비스 레이어 테스트가 부담 됐음. 의존성이 많고 테스트 하려면 다 Mocking 해야 하기 때문.
- 최근 DDD를 얕게 공부하고 서비스 레이어를 얇게 가져가려는 노력. 테스트도 안 만듬. (도메인 서비스 개념은 아직 잘 모르겠다..)
- 대신 모델을 풍부하게 하려 함. 테스트도 편함.
- 그리고 통합 테스트(?) 비슷한 컨트롤러 테스트 도입.
- 근데 이 테스트도 부담 됨. 사전에 데이터 준비하는 것도 부담, 응답의 필드 하나 하나도 전부 검증해야 하는건지도 의문. 어떡하지?



## 의식적인 연습으로 TDD, 리팩토링 연습하기, 박재성님
- 전 회사에서 사내 교육, 코드스쿼드 교육때 이어 세번째 들은 내용이지만 좋았음.
- 최근에 관련 내용을 [책](https://book.naver.com/bookdb/book_detail.nhn?bid=13993648)으로도 내신 듯.
- 요점은 그냥 연습하지 말고 의식적으로 연습해야 한다. 그것을 위한 방법들.
- 객체지향 프로그래밍 연습을 위한 [소트웍스 앤솔러지의 객체지향생활체조](https://github.com/iamkyu/TIL/blob/master/object-calisthenics/object-calisthenics.md)는 참 좋은 듯.



## 테알못 신입은 어떻게 테스트를 시작했을까?, 이혜승님
- TDD를 처음 하는 과정에서 배운 것과 느낀것들이 많이 공감됨.
- 발표하신 내용 중 일부는 위 아래 다른 섹션 정리에 녹여서 정리함.
- 제시해주신 자신만의 불필요한 테스트 구분 기준이 좋았음.
    - 비즈니스와 관련된 버그를 낼 가능성이 낮거나 없을 때.
    - 테스트를 유지함으로써 얻는 이익 < 테스트 유지 관리에 드는 비용일 때.
    - 테스트가 단언하고 있는 내용이 사용자에게 중요한 가치를 주는 것이 아닐 때.



## 테스트를 돌보기 위한 매우 간단한 실천 방법들, 그리고 효과, 양완수님
- 테스트 코드는 프로젝트 코드가 사용되는 최초의 장소이며 고객.
- 진열 상품의 옵션 중 일부 가격을 변경하는 코드를 테스트 하는 코드의 리팩토링 과정을 보여주심.
    - 장황한 Given.
    - 수 많은 의존성. 그에 따른 수 많은 Mock.
    - 하나의 테스트 여러가지 검증.
    - 테스트코드에 SOLID 원칙을 적용하면서 테스트 코드뿐만 아니라 프로덕션 코드가 높은 응집, 낮은결합을 이룸.
- 코드 예제는 [https://github.com/yangwansu/okkycon2018/commits/master](https://github.com/yangwansu/okkycon2018/commits/master)



## 당신들의 TDD가 실패하는 이유, 이규원님
- 라이브 코딩도 하셨는데 TDD 과정 보다 오히려 코딩 전까지의 과정이 인상적.
- 요구사항을 받으면 요건을 분석하고 유저스토리를 도출해서 Jira 티켓을 등록. 
    - ex. 박스오피스 운영자가 관리자 앱에서 새 영화를 추가 한다.
    - 요구사항을 대충 분석하는게 아니라 그림을 그리고 기획자와 같이 토론 하며 분석함.
- "소프트웨어로 사용자에게 어떤 가치를 전달할 것인가"에 대한 진지한 고민.
- 유저스토리를 Jira 등록한 후, 코드 설계를 고민하고 구체적인 기술에 관련된 티켓들을 세세히 하위 테스크로 등록함.
- 세미나 끝나고 집에 오는 길에 마침 RSS 받은 글이 [Product Manager 관점에서 바라 본 TDD](https://getpocket.com/a/read/2174455870)인데, 'User Story에 적힌 첫 번째 스펙(Acceptance Criteria)을 충족하기 위한 테스트 코드를 작성' 한다는 내용이 있음.
- Jira 티켓에 테스트 케이스들을  함. 즉, 요건을 만족하는 테스트케이스들을 미리 고민.
    - [TDD에 대한 오해와 진실 TDD 이야기](https://book.naver.com/bookdb/book_detail.nhn?bid=7422964) 책 4장에서 Top-Down Approach TDD에 대해 얘기함.
    - 테스트케이스들을 Top-Down으로 방향을 잡고, Bottom-Up으로 세부 구현.
- 개발자 수준에서 검증할 수 없으면 테스트 케이스를 기획팀이나 Q.A팀에 전달할 수도 있음. 꼭 Q.A팀에서 모든 테스트케이스를 나열해야 하는건 아님.
- Visual Studio에서 클래스 파일을 열지 않아도 코드 미리 보기가 되길래 IntelliJ는 그런 기능이 없나 찾아보니 [Quick Definition](https://www.jetbrains.com/help/idea/viewing-definition.html) (`Opt` + `Space`)이 있음.
